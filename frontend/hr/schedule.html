<!DOCTYPE html>
<html>
  <head>
    <title>HR - Schedule Interview</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #eff4fc;
        margin: 0;
        padding: 60px 0 30px 0;
        position: relative;
      }

      .container {
        width: 60%;
        margin: 50px auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      h1 {
        text-align: center;
        color: #333;
      }

      label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
      }

      input[type="text"],
      input[type="email"],
      input[type="datetime-local"],
      select {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }

      select {
        height: 34px;
      }

      button {
        background-color: #5cb85c;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 20px;
      }

      button:hover {
        background-color: #4cae4c;
      }

      .employee-list {
        margin-top: 20px;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 10px;
      }

      .employee-list h2 {
        margin-top: 0;
        color: #555;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }

      th {
        background-color: #f0f0f0;
      }

      .header {
        background-color: white;
        color: #344767;
        height: 50px;
        position: relative;
        padding: 10px 20px;
        text-align: center;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 100;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .header-left {
        display: flex;
        align-items: center;
      }

      .logo {
        height: 120px;
        margin-right: 15px;
      }
      .header-center {
        flex-grow: 1;
      }

      .nav {
        display: flex;
        justify-content: center;
        margin-top: 10px;
      }

      .nav a {
        color: #192944;
        text-decoration: none;
        padding: 10px 20px;
        border-radius: 5px;
        margin: 0 5px;
      }

      .nav a:hover {
        background-color: #e4efff;
      }
      .logout-btn {
        background-color: #e94e31;
        border: none;
        border-radius: 5px;
        padding: 8px 15px;
        cursor: pointer;
        margin: 0px 40px;
      }

      .logout-btn a {
        color: white;
        text-decoration: none;
      }

      .logout-btn:hover {
        background-color: #777;
      }

      /* Media Queries for Responsive Design */
      @media screen and (max-width: 1200px) {
        .container {
          width: 80%;
        }
      }

      @media screen and (max-width: 992px) {
        .container {
          width: 90%;
        }

        .logo {
          height: 80px;
        }

        .logout-btn {
          margin: 0px 20px;
        }
      }

      @media screen and (max-width: 768px) {
        body {
          padding-top: 120px;
        }

        .header {
          height: auto;
          flex-direction: column;
          padding: 10px;
        }

        .header-left {
          margin-bottom: 10px;
        }

        .header-center {
          width: 100%;
        }

        .nav {
          flex-wrap: wrap;
        }

        .nav a {
          margin: 5px;
          font-size: 14px;
          padding: 8px 15px;
        }

        .logout-btn {
          margin: 10px 0;
        }

        .logo {
          height: 60px;
          margin-right: 5px;
        }
      }

      @media screen and (max-width: 576px) {
        .container {
          width: 95%;
          margin: 20px auto;
          padding: 15px;
        }

        h1 {
          font-size: 24px;
        }

        .employee-list {
          overflow-x: auto;
        }

        table {
          font-size: 14px;
        }

        th,
        td {
          padding: 6px;
        }

        button {
          width: 100%;
        }
      }

      @media screen and (max-width: 480px) {
        body {
          padding-top: 150px;
        }

        .nav {
          flex-direction: column;
          align-items: center;
        }

        .nav a {
          width: 80%;
          text-align: center;
          margin: 3px 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="header-left">
        <img src="/images/logoimage.png" alt="Company Logo" class="logo" />
      </div>
      <div class="header-center">
        <div class="nav">
          <a href="schedule.html">Schedule Interview</a>
          <a href="dashboard.html">Dashboard</a>
          <a href="record.html">Evaluation Records</a>
        </div>
      </div>
      <button class="logout-btn"><a href="../index.html">Logout</a></button>
    </div>
    <div class="container">
      <h1>Schedule Interview</h1>

      <label for="intervieweeName">Interviewee Name:</label>
      <input type="text" id="intervieweeName" name="intervieweeName" required />

      <label for="intervieweeEmail">Interviewee Email:</label>
      <input
        type="email"
        id="intervieweeEmail"
        name="intervieweeEmail"
        required
      />

      <label for="intervieweeResume">Interviewee Resume (URL):</label>
      <input
        type="text"
        id="intervieweeResume"
        name="intervieweeResume"
        placeholder="Enter URL"
        required
      />

      <label for="interviewRound">Interview Round:</label>
      <select id="level" name="level" required>
        <option value="">Select Interview Round</option>
        <option value="level1">L1</option>
        <option value="level2">L2</option>
      </select>

      <label for="interviewer">Interviewer:</label>
      <select id="interviewer" name="interviewer" required>
        <option value="">Select Interviewer</option>
      </select>

      <label for="interviewDateTime">Interview Date & Time:</label>
      <input
        type="datetime-local"
        id="interviewDateTime"
        name="interviewDateTime"
        required
      />

      <button id="scheduleBtn">Schedule Interview</button>

      <div class="employee-list">
        <h2>Interviewee List</h2>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Resume</th>
            </tr>
          </thead>
          <tbody id="intervieweeTableBody">
            <!-- Data will be dynamically added here -->
          </tbody>
        </table>
      </div>
    </div>
    <script>
      // Function to fetch interviewers and populate the dropdown
      function populateInterviewers() {
        fetch("http://localhost:8080/api/users/getinterviewer") // Replace with your actual API endpoint
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
          })
          .then((interviewers) => {
            const interviewerSelect = document.getElementById("interviewer");
            interviewers.forEach((interviewer) => {
              const option = document.createElement("option");
              option.value = interviewer.email; // Use email as value
              option.textContent = interviewer.name; // Display interviewer's name or email
              interviewerSelect.appendChild(option);
            });
          })
          .catch((error) =>
            console.error("Error fetching interviewers:", error)
          );
      }

      document.addEventListener("DOMContentLoaded", function () {
        function scheduleInterview() {
          const intervieweeName = document.getElementById("intervieweeName");
          const intervieweeEmail = document.getElementById("intervieweeEmail");
          const intervieweeResume =
            document.getElementById("intervieweeResume");
          const interviewer = document.getElementById("interviewer");
          const interviewDateTime =
            document.getElementById("interviewDateTime");
          const typeOfInterview = document.getElementById("typeOfInterview");

          if (
            !intervieweeName.value ||
            !intervieweeEmail.value ||
            !intervieweeResume.value ||
            !interviewer.value ||
            !interviewDateTime.value
          ) {
            alert("Please fill in all the fields.");
            return;
          }

          const scheduleData = {
            typeOfInterview: document.getElementById("level").value,
            intervieweeEmail: intervieweeEmail.value,
            intervieweeName: intervieweeName.value,
            email: interviewer.value,
            resumeLink: intervieweeResume.value,
            interviewDate: interviewDateTime.value,
          };

          console.log(scheduleData);

          fetch("http://localhost:8080/api/schedules", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(scheduleData),
          })
            .then((response) => {
              if (!response.ok)
                throw new Error(`HTTP error! Status: ${response.status}`);
              return response.json();
            })
            .then((data) => {
              console.log("Success:", data);
              alert("Interview scheduled successfully!");
              sendEmail(interviewer.value, interviewDateTime.value);
            })
            .catch((error) => {
              console.error("Error:", error);
              alert("An error occurred. Please try again.");
              
            });
        }

        function sendEmail(email, dateTime) {
          emailjs.init("-ERYtWewRPd26lbez");
          emailjs
            .send("service_bczd6pb", "template_cydxr7w", {
              to_email: email,
              message: `Your interview is scheduled on ${dateTime}`,
            })
            .then((response) =>
              console.log("Email sent successfully!", response)
            )
            .catch((error) => console.error("Email sending failed:", error));
        }

        document
          .getElementById("scheduleBtn")
          .addEventListener("click", scheduleInterview);
      });

      // Call populateInterviewers when the page loads
      window.onload = populateInterviewers;
    </script>
  </body>
</html>
